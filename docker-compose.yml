# Note: version is obsolete in newer Docker Compose, but kept for compatibility

services:
  # Flask Web Application Service
  # Connects to MariaDB/MySQL database at ilmuwanutara.my
  # Note: Database is MariaDB 10.3.39 on the server
  web:
    build: .
    container_name: water_monitor_web
    restart: always
    ports:
      - "${FLASK_PORT:-5000}:5000"
    environment:
      # Database connection (MariaDB at ilmuwanutara.my)
      # If using SSH tunnel, set DB_HOST to host.docker.internal
      # If connecting directly, use ilmuwanutara.my (requires remote access granted)
      DB_HOST: ${DB_HOST:-host.docker.internal}
      DB_PORT: ${DB_PORT:-3306}
      DB_USER: ${DB_USER:-ilmuwanutara_e2eewater}
      DB_PASSWORD: ${DB_PASSWORD:-e2eeWater@2025}
      DB_NAME: ${DB_NAME:-ilmuwanutara_e2eewater}
      DB_TYPE: mysql
      # Flask configuration
      FLASK_HOST: 0.0.0.0
      FLASK_RUN_PORT: 5000
      PORT: 5000
      FLASK_ENV: ${FLASK_ENV:-production}
      FLASK_DEBUG: ${FLASK_DEBUG:-0}
      PYTHONUNBUFFERED: 1
      # Add any other environment variables your app needs
    volumes:
      # Mount keys directory for persistence (optional)
      - ./keys:/app/keys
      - ./user_keys:/app/user_keys
      - ./sensor_keys:/app/sensor_keys
    # Uncomment the line below if running Docker on the same server as MariaDB
    # and you want to use host network (Linux only)
    # network_mode: "host"
    # Alternative: Use extra_hosts to map host.docker.internal (if not available)
    extra_hosts:
      - "host.docker.internal:host-gateway"

